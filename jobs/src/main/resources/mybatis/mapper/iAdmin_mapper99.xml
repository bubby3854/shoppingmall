<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.jobs.dao.IAdminDao99">
	<select id="getRegistrations">
		SELECT
			YEAR,
			MONTH,
			member_type,
			SUM(total_registrations) AS total_registrations
		FROM(
			SELECT 
				YEAR(make_date) AS YEAR,
				MONTH(make_date) AS MONTH,
				'member' AS member_type,
				COUNT(*) AS total_registrations
			FROM member
			GROUP BY 
				YEAR(make_date), MONTH(make_date)
				
			UNION ALL
			
			SELECT 
				YEAR(make_date) AS YEAR,
				MONTH(make_date) AS MONTH,
				'company' AS member_type,
				COUNT(*) AS total_registrations
			FROM company
			GROUP BY 
				YEAR(make_date), MONTH(make_date)
		) AS combined
		GROUP BY 
			YEAR, MONTH, member_type
		ORDER BY 
			YEAR DESC, MONTH DESC, member_type
	</select>
</mapper>